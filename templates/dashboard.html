<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gesture Control Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/hands.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js" crossorigin="anonymous"></script>
<script src="/static/dashboard.js" defer></script>

<style>

/* =========================
   NEOMORPHIC DARK THEME
========================= */

:root{
  --bg:#0b0f1a;
  --panel:#111827;
  --soft:#1a2236;
  --accent:#7c83ff;
  --accent-glow: rgba(124,131,255,0.35);
  --text:#e6ebff;
  --muted:#9aa3c7;
  --shadow-light: rgba(255,255,255,0.04);
  --shadow-dark: rgba(0,0,0,0.6);
}

*{ margin:0; padding:0; box-sizing:border-box; font-family: Inter, system-ui, sans-serif; }

body{
  background: radial-gradient(circle at 20% 10%, #141a2e, #05070f 70%);
  color:var(--text);
  min-height:100vh;
  padding:24px;
  outline: none;
  overflow: hidden;
}

.container{ max-width:1300px; margin:auto; }

.card{
  background:var(--panel);
  border-radius:18px;
  padding:22px;
  box-shadow: 10px 10px 25px var(--shadow-dark), -6px -6px 18px var(--shadow-light);
}

.section-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
}

button{
  border:none;
  padding:10px 18px;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  color:white;
  background:var(--soft);
  box-shadow: 4px 4px 12px var(--shadow-dark), -2px -2px 8px var(--shadow-light);
  margin-top: 10px;
  transition: box-shadow 0.15s, opacity 0.15s;
}

button:hover{
  box-shadow: inset 4px 4px 10px var(--shadow-dark), inset -2px -2px 8px var(--shadow-light);
}

.btn-primary{ background:var(--accent); box-shadow:0 0 12px var(--accent-glow); }
.btn-success{ background:#10b981; }
.btn-warning{ background:#f59e0b; }
.btn-danger { background:#ef4444; }

input, select{
  width:100%;
  padding:10px 14px;
  border:none;
  border-radius:10px;
  background:var(--soft);
  color:var(--text);
  box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
  outline: none;
}

/* Remove spinner arrows on number inputs */
input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button{ -webkit-appearance:none; margin:0; }
input[type=number]{ -moz-appearance:textfield; appearance:textfield; }

h2{ color:var(--accent); margin-bottom:14px; font-size:1.2rem; }
label{ font-size:0.8rem; color:var(--muted); margin-bottom:4px; display:block; }

.inline-fields{ display:flex; gap:12px; margin-bottom:6px; }
.inline-fields .field{ flex:1; }

@media(max-width:600px){ .inline-fields{ flex-direction:column; } }
@media(max-width:1024px){ .section-grid{ grid-template-columns:1fr 1fr; } }
@media(max-width:768px){ .section-grid{ grid-template-columns:1fr; } }

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.top-bar{ display:flex; justify-content:center; margin-bottom:28px; }

.unified-bar{
  width:100%;
  max-width:1300px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:18px 28px;
  border-radius:22px;
}

.brand-block{ display:flex; flex-direction:column; line-height:1.1; }
.brand-block h1{ font-size:1.5rem; font-weight:800; }
.brand-block span{ font-size:0.8rem; color:var(--muted); letter-spacing:0.05em; }

.engine-controls{ display:flex; align-items:center; gap:16px; }
.engine-controls button{ padding:8px 16px; border-radius:10px; font-size:0.9rem; }

.headtop{ margin:auto; }

.current-gesture{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 18px;
  border-radius:30px;
  background:var(--soft);
  font-weight:700;
  margin-left:6px;
  font-size:0.9rem;
  box-shadow: inset 4px 4px 10px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light);
  white-space:nowrap;
  min-width:240px;
  justify-content:flex-start;
}

.current-gesture .gesture-label{
  color:var(--muted);
  font-weight:500;
  font-size:0.78rem;
  letter-spacing:0.04em;
}

.current-gesture .gesture-value{
  color:var(--text);
  font-weight:800;
}

.current-gesture .gesture-conf{
  color:var(--accent);
  font-size:0.78rem;
  font-weight:600;
}

/* ‚îÄ‚îÄ SYSTEM STATUS INDICATOR ‚îÄ‚îÄ */
.system-status{
  display:flex;
  align-items:center;
  gap:7px;
  padding:7px 14px;
  border-radius:30px;
  background:var(--soft);
  box-shadow: inset 3px 3px 8px var(--shadow-dark), inset -2px -2px 6px var(--shadow-light);
  font-size:0.8rem;
  font-weight:600;
  color:var(--muted);
  letter-spacing:0.04em;
  white-space:nowrap;
}

.status-dot{
  width:9px;
  height:9px;
  border-radius:50%;
  background:var(--muted);
  flex-shrink:0;
  transition:background 0.3s, box-shadow 0.3s;
}

.status-dot.active{
  background:#10b981;
  box-shadow:0 0 8px rgba(16,185,129,0.7);
  animation:pulse-dot 2s infinite;
}

.status-dot.stopped{
  background:#ef4444;
  box-shadow:0 0 6px rgba(239,68,68,0.5);
  animation:none;
}

.status-dot.paused{
  background:#f59e0b;
  box-shadow:0 0 6px rgba(245,158,11,0.5);
  animation:none;
}

@keyframes pulse-dot{
  0%,100%{ box-shadow:0 0 6px rgba(16,185,129,0.5); }
  50%    { box-shadow:0 0 14px rgba(16,185,129,0.9); }
}

/* ‚îÄ‚îÄ MAPPINGS SECTION ‚îÄ‚îÄ */
.mappings-section{ margin-top:14px; }

.mappings-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:8px;
}

.mappings-header .label-text{
  font-size:0.75rem;
  font-weight:700;
  color:var(--muted);
  letter-spacing:0.07em;
  text-transform:uppercase;
}

.count-badge{
  background:var(--soft);
  color:var(--accent);
  font-size:0.72rem;
  font-weight:700;
  padding:2px 9px;
  border-radius:20px;
  box-shadow:inset 2px 2px 5px var(--shadow-dark), inset -1px -1px 3px var(--shadow-light);
  min-width:24px;
  text-align:center;
}

.mappings-scroll{
  display:flex;
  flex-direction:column;
  gap:5px;
  max-height:155px;
  overflow-y:auto;
  padding-right:2px;
}

.mappings-scroll::-webkit-scrollbar{ width:3px; }
.mappings-scroll::-webkit-scrollbar-track{ background:transparent; }
.mappings-scroll::-webkit-scrollbar-thumb{
  background:rgba(124,131,255,0.3);
  border-radius:4px;
}

/* Individual mapping chip */
.mapping-chip{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:7px 10px 7px 12px;
  border-radius:10px;
  background:var(--soft);
  box-shadow:3px 3px 8px var(--shadow-dark), -1px -1px 5px var(--shadow-light);
  transition:box-shadow 0.15s;
  animation: chipIn 0.2s ease;
}

@keyframes chipIn{
  from{ opacity:0; transform:translateY(-4px); }
  to  { opacity:1; transform:translateY(0); }
}

.mapping-chip:hover{ box-shadow:5px 5px 14px var(--shadow-dark), -2px -2px 8px var(--shadow-light); }

.chip-left{
  display:flex;
  align-items:center;
  gap:7px;
  flex:1;
  min-width:0;
}

.chip-gesture{
  font-size:0.82rem;
  font-weight:700;
  color:var(--text);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:90px;
}

.chip-sep{
  color:var(--accent);
  font-size:0.65rem;
  opacity:0.6;
  flex-shrink:0;
}

.chip-action{
  font-size:0.76rem;
  color:var(--muted);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  background:rgba(124,131,255,0.1);
  padding:2px 7px;
  border-radius:6px;
  border:1px solid rgba(124,131,255,0.18);
}

.chip-remove{
  background:transparent !important;
  border:none;
  padding:4px 6px;
  margin:0;
  margin-top:0 !important;
  box-shadow:none !important;
  cursor:pointer;
  color:rgba(239,68,68,0.45);
  font-size:0.72rem;
  line-height:1;
  flex-shrink:0;
  border-radius:6px;
  transition:color 0.15s, background 0.15s !important;
}

.chip-remove:hover{
  color:#ef4444 !important;
  background:rgba(239,68,68,0.12) !important;
  box-shadow:none !important;
  transform:none;
}

.mappings-empty{
  text-align:center;
  font-size:0.8rem;
  color:var(--muted);
  opacity:0.4;
  padding:22px 0;
  letter-spacing:0.04em;
}

/* ‚îÄ‚îÄ DELETE ROW ‚îÄ‚îÄ */
.delete-row{
  display:flex;
  align-items:flex-end;
  gap:10px;
  margin-top:14px;
  padding-top:12px;
  border-top:1px solid rgba(255,255,255,0.06);
}

.delete-row .field{ flex:1; }
.delete-row select{ padding:8px 12px; font-size:0.85rem; }
.delete-row button{
  margin-top:0;
  padding:8px 14px;
  font-size:0.82rem;
  border-radius:10px;
  white-space:nowrap;
  flex-shrink:0;
}

/* ‚îÄ‚îÄ CAMERA VIEWPORT ‚îÄ‚îÄ */
#video-container{
  margin-top:14px;
  border-radius:14px;
  overflow:hidden;
  background:#000;
  box-shadow:inset 0 0 25px rgba(0,0,0,0.7), 0 0 20px rgba(0,0,0,0.4);
  position:relative;
}

#canvas{
  width:100%;
  height:auto;
  display:block;
  border-radius:10px;
}

#feed-placeholder{
  display:none;
  width:100%;
  aspect-ratio:4/3;
  background:var(--soft);
  border-radius:10px;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  color:var(--muted);
  font-size:0.9rem;
  box-shadow:inset 4px 4px 16px var(--shadow-dark), inset -4px -4px 12px var(--shadow-light);
}

#feed-placeholder i{ font-size:3rem; color:var(--accent); opacity:0.4; }
#feed-placeholder span{ letter-spacing:0.06em; font-weight:600; opacity:0.55; }

/* ‚îÄ‚îÄ TOGGLE SWITCH ‚îÄ‚îÄ */
.feed-toggle-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-top:10px;
  margin-bottom:2px;
}

.feed-toggle-row span{
  font-size:0.8rem;
  color:var(--muted);
  font-weight:600;
  letter-spacing:0.04em;
}

.toggle-switch{ position:relative; width:46px; height:24px; flex-shrink:0; }
.toggle-switch input{ opacity:0; width:0; height:0; }

.toggle-slider{
  position:absolute;
  inset:0;
  background:var(--soft);
  border-radius:24px;
  cursor:pointer;
  transition:background 0.25s;
  box-shadow:inset 2px 2px 6px var(--shadow-dark), inset -2px -2px 4px var(--shadow-light);
}

.toggle-slider::before{
  content:'';
  position:absolute;
  width:18px; height:18px;
  left:3px; top:3px;
  background:var(--muted);
  border-radius:50%;
  transition:transform 0.25s, background 0.25s;
}

.toggle-switch input:checked + .toggle-slider{ background:rgba(124,131,255,0.25); }
.toggle-switch input:checked + .toggle-slider::before{
  transform:translateX(22px);
  background:var(--accent);
  box-shadow:0 0 8px var(--accent-glow);
}

/* ‚îÄ‚îÄ OPTGROUP STYLING ‚îÄ‚îÄ */
select optgroup{ color:var(--accent); font-size:0.78rem; }
select option{ background:#1a2236; color:var(--text); }


/* ‚îÄ‚îÄ ACTIVITY LOGS ‚îÄ‚îÄ */
.log-entry{
  display:flex;
  align-items:flex-start;
  gap:8px;
  padding:7px 10px;
  border-radius:9px;
  background:var(--soft);
  box-shadow:2px 2px 6px var(--shadow-dark), -1px -1px 4px var(--shadow-light);
  font-size:0.78rem;
  animation: chipIn 0.2s ease;
}

.log-icon{ flex-shrink:0; margin-top:1px; font-size:0.72rem; }
.log-text{ color:var(--text); font-weight:500; flex:1; line-height:1.4; }
.log-time{ color:var(--muted); font-size:0.7rem; flex-shrink:0; margin-top:1px; opacity:0.7; }

.log-entry.success .log-icon{ color:#10b981; }
.log-entry.error   .log-icon{ color:#ef4444; }
.log-entry.info    .log-icon{ color:var(--accent); }

</style>
</head>

<body>
<div class="container">

  <!-- TOP BAR -->
  <div class="top-bar">
    <div class="card system-bar unified-bar">
      <div class="brand-block">
        <h1>Gesture Control</h1>
        <span>Smart Desktop Interface</span>
      </div>
      <div class="engine-controls">
        <h2 class="headtop"><i class="fas fa-microchip"></i> Engine</h2>
        <div class="system-status">
          <span class="status-dot" id="system-dot"></span>
          <span id="system-status-text">Idle</span>
        </div>
        <button class="btn-primary" onclick="startSystem()"><i class="fas fa-play"></i> Start</button>
        <button class="btn-warning" onclick="pauseSystem()"><i class="fas fa-pause"></i> Pause</button>
        <button class="btn-danger"  onclick="stopSystem()"><i class="fas fa-stop"></i> Stop</button>
        <div id="current-gesture" class="current-gesture">
          <span class="gesture-label">Gesture:</span>
          <span class="gesture-value" id="gesture-name-display">None</span>
          <span class="gesture-conf" id="gesture-conf-display"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="section-grid">

    <!-- TRAINING LAB -->
    <div class="card">
      <h2><i class="fas fa-video"></i> Training Lab</h2>

      <div class="inline-fields">
        <div class="field">
          <label>Gesture Label</label>
          <input id="gesture-name" placeholder="Swipe Left">
        </div>
        <div class="field">
          <label>Data Density</label>
          <select id="sample-count">
            <option>50</option>
            <option selected>100</option>
            <option>200</option>
          </select>
        </div>
      </div>

      <button class="btn-success" onclick="startRecording()">
        <i class="fas fa-camera"></i> Start Recording
      </button>
      <button class="btn-danger" onclick="stopRecording()" id="stop-btn" style="display:none; margin-left:8px;">
        <i class="fas fa-stop-circle"></i> Stop
      </button>

      <div id="video-container">
        <canvas id="canvas" width="640" height="480"></canvas>
        <div id="feed-placeholder">
          <i class="fas fa-video-slash"></i>
          <span>FEED PAUSED</span>
        </div>
      </div>

      <div class="feed-toggle-row">
        <span><i class="fas fa-circle" id="feed-dot" style="color:var(--muted); font-size:0.55rem; margin-right:5px;"></i>Live Feed</span>
        <label class="toggle-switch" title="Toggle live feed">
          <input type="checkbox" id="feed-toggle" checked onchange="toggleFeed(this.checked)">
          <span class="toggle-slider"></span>
        </label>
      </div>

      <div id="progress" style="margin-top:8px; font-size:0.85rem; color:var(--muted);">Capture: 0%</div>
    </div>

    <!-- COMMAND MAP -->
    <div class="card">
      <h2><i class="fas fa-project-diagram"></i> Command Map</h2>

      <label>Recognized Gesture</label>
      <select id="gesture-select"></select>

      <label style="margin-top:10px;">System Action</label>
      <select id="action-select">
        <optgroup label="üéµ  Media">
          <option value="play_pause">Play / Pause</option>
          <option value="next_track">Next Track</option>
          <option value="prev_track">Previous Track</option>
          <option value="stop_media">Stop Media</option>
          <option value="mute">Mute / Unmute</option>
          <option value="volume_up">Volume Up</option>
          <option value="volume_down">Volume Down</option>
        </optgroup>
        <optgroup label="ü™ü  Window">
          <option value="next_window">Next Window</option>
          <option value="prev_window">Previous Window</option>
          <option value="minimize_window">Minimize Window</option>
          <option value="maximize_window">Maximize / Restore</option>
          <option value="close_window">Close Window</option>
          <option value="snap_left">Snap Left</option>
          <option value="snap_right">Snap Right</option>
        </optgroup>
        <optgroup label="üñ•Ô∏è  Desktop">
          <option value="screenshot">Screenshot</option>
          <option value="show_desktop">Show Desktop</option>
          <option value="task_view">Task View</option>
          <option value="virtual_desktop_next">Virtual Desktop ‚Üí</option>
          <option value="virtual_desktop_prev">Virtual Desktop ‚Üê</option>
          <option value="open_taskbar">Open Taskbar / Launcher</option>
        </optgroup>
        <optgroup label="‚öôÔ∏è  System">
          <option value="lock_screen">Lock Screen</option>
          <option value="sleep">Sleep</option>
          <option value="brightness_up">Brightness Up</option>
          <option value="brightness_down">Brightness Down</option>
          <option value="open_settings">Open Settings</option>
          <option value="open_terminal">Open Terminal</option>
          <option value="open_file_manager">Open File Manager</option>
          <option value="open_calculator">Open Calculator</option>
        </optgroup>
        <optgroup label="üìú  Scroll">
          <option value="scroll_up">Scroll Up</option>
          <option value="scroll_down">Scroll Down</option>
          <option value="scroll_left">Scroll Left</option>
          <option value="scroll_right">Scroll Right</option>
          <option value="page_up">Page Up</option>
          <option value="page_down">Page Down</option>
          <option value="scroll_top">Jump to Top</option>
          <option value="scroll_bottom">Jump to Bottom</option>
        </optgroup>
        <optgroup label="üåê  Browser">
          <option value="browser_back">Browser Back</option>
          <option value="browser_forward">Browser Forward</option>
          <option value="browser_refresh">Refresh Page</option>
          <option value="new_tab">New Tab</option>
          <option value="close_tab">Close Tab</option>
          <option value="next_tab">Next Tab</option>
          <option value="prev_tab">Previous Tab</option>
          <option value="reopen_tab">Reopen Closed Tab</option>
        </optgroup>
        <optgroup label="‚úÇÔ∏è  Clipboard">
          <option value="copy">Copy</option>
          <option value="paste">Paste</option>
          <option value="cut">Cut</option>
          <option value="undo">Undo</option>
          <option value="redo">Redo</option>
          <option value="select_all">Select All</option>
        </optgroup>
      </select>

      <button class="btn-primary" onclick="updateAction()" style="margin-top:10px;">
        <i class="fas fa-link"></i> Bind Action
      </button>

      <!-- Active Mappings -->
      <div class="mappings-section">
        <div class="mappings-header">
          <span class="label-text"><i class="fas fa-list" style="margin-right:5px; opacity:0.5;"></i>Active Mappings</span>
          <span class="count-badge" id="mapping-count">0</span>
        </div>
        <div class="mappings-scroll" id="mappings-scroll">
          <div class="mappings-empty" id="mappings-empty">No mappings bound yet</div>
        </div>
      </div>

      <!-- Delete Gesture -->
      <div class="delete-row">
        <div class="field">
          <label><i class="fas fa-trash-alt" style="margin-right:4px; opacity:0.6;"></i>Delete Gesture</label>
          <select id="delete-gesture-select"></select>
        </div>
        <button class="btn-danger" onclick="deleteGesture()">
          <i class="fas fa-trash"></i> Delete
        </button>
      </div>
    </div>

    <!-- NEURAL LOGIC -->
    <div class="card">
      <h2><i class="fas fa-brain"></i> Neural Logic</h2>
      <p style="color:var(--muted); font-size:0.85rem; margin-top:5px;">
        Sync the local neural network with new gesture samples.
      </p>
      <button class="btn-success" onclick="retrainModel()" style="margin-top:10px;">
        <i class="fas fa-sync"></i> Retrain Model
      </button>
      <h2 style="margin-top:24px;"><i class="fas fa-sliders-h"></i> Sensitivity</h2>
      <label>Confidence Threshold (%)</label>
      <input id="confidence-threshold" type="number" value="60" min="0" max="100">
      <button class="btn-primary" onclick="updateThreshold()">Apply</button>
      <h2 style="margin-top:20px;"><i class="fas fa-book"></i> Activity Logs</h2>
      <div id="log-list" style="display:flex;flex-direction:column;gap:6px;margin-top:6px;">
        <!-- log entries injected by JS -->
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/vision_bundle.js" crossorigin="anonymous"></script>
</body>
</html>